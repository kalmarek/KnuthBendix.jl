<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Using a stack · KnuthBendix.jl</title><meta name="title" content="Using a stack · KnuthBendix.jl"/><meta property="og:title" content="Using a stack · KnuthBendix.jl"/><meta property="twitter:title" content="Using a stack · KnuthBendix.jl"/><meta name="description" content="Documentation for KnuthBendix.jl."/><meta property="og:description" content="Documentation for KnuthBendix.jl."/><meta property="twitter:description" content="Documentation for KnuthBendix.jl."/><meta property="og:url" content="https://kalmarek.github.io/KnuthBendix.jl/knuthbendix2/"/><meta property="twitter:url" content="https://kalmarek.github.io/KnuthBendix.jl/knuthbendix2/"/><link rel="canonical" href="https://kalmarek.github.io/KnuthBendix.jl/knuthbendix2/"/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">KnuthBendix.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><span class="tocitem">Theory</span><ul><li><a class="tocitem" href="../theory/">Monoids and the word problem</a></li><li><a class="tocitem" href="../knuthbendix_completion/">Confluence and the Knuth-Bendix completion</a></li></ul></li><li><span class="tocitem">Words and Alphabets</span><ul><li><a class="tocitem" href="../words/">Words</a></li><li><a class="tocitem" href="../alphabets/">Alphabets</a></li><li><a class="tocitem" href="../orders/">Orders</a></li></ul></li><li><span class="tocitem">Rewriting</span><ul><li><a class="tocitem" href="../rewriting/">On rewriting</a></li><li><a class="tocitem" href="../rewriting_system/">Rewriting System</a></li></ul></li><li><span class="tocitem">Knuth-Bendix completion</span><ul><li><a class="tocitem" href="../KB_implementations/">Implementations of Knuth-Bendix completion</a></li><li><a class="tocitem" href="../knuthbendix1/">Naive</a></li><li class="is-active"><a class="tocitem" href>Using a stack</a><ul class="internal"><li><a class="tocitem" href="#Internal-functions"><span>Internal functions</span></a></li></ul></li><li><a class="tocitem" href="../knuthbendix_idxA/">Using index automaton</a></li><li><a class="tocitem" href="../knuthbendix_pfxA/">Using prefix automaton</a></li></ul></li><li><span class="tocitem">Automata</span><ul><li><a class="tocitem" href="../automata/">Interface</a></li><li><a class="tocitem" href="../backtrack/">Backtrack searches</a></li><li><a class="tocitem" href="../index_automaton/">Index Automaton</a></li><li><a class="tocitem" href="../prefix_automaton/">Prefix Automaton</a></li></ul></li><li><a class="tocitem" href="../parsing_kbmag/">Parsing <code>kbmag</code> input files</a></li><li><span class="tocitem">Applications</span><ul><li><a class="tocitem" href="../nc_groebner/">Non-commutative Gröbner bases</a></li><li><a class="tocitem" href="../builtin_examples/">Example rewriting systems</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Knuth-Bendix completion</a></li><li class="is-active"><a href>Using a stack</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Using a stack</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/kalmarek/KnuthBendix.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/kalmarek/KnuthBendix.jl/blob/master/docs/src/knuthbendix2.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Using-a-stack"><a class="docs-heading-anchor" href="#Using-a-stack">Using a stack</a><a id="Using-a-stack-1"></a><a class="docs-heading-anchor-permalink" href="#Using-a-stack" title="Permalink"></a></h1><p>As can be observed in <a href="../knuthbendix_completion/#Knuth-Bendix-completion-an-example">Knuth Bendix completion - an example</a> after we have added rule 6, there was no point considering rule 5, since it was rendered redundant. This can be achieved by maintaining the reducedness property of the rewriting system during the completion.</p><article><details class="docstring" open="true"><summary id="KnuthBendix.KBStack"><a class="docstring-binding" href="#KnuthBendix.KBStack"><code>KnuthBendix.KBStack</code></a> — <span class="docstring-category">Type</span></summary><section><div><pre><code class="language-julia hljs">KBStack &lt;: KBS2Alg &lt;: CompletionAlgorithm</code></pre><p>The Knuth-Bendix completion algorithm that (if successful) yields the reduced, confluent rewriting system generated by rules of <code>rws</code>.</p><p><code>KBStack</code> uses a stack of new rules and with each addition of a new rule to the rewriting system all rules potentially redundant are moved onto the stack. This way the rewriting system is always reduced and only the non-redundant rules are considered for finding critical pairs.</p><p>This implementation follows closely <code>KBS_2</code> procedure as described in <strong>Section 2.6</strong><sup class="footnote-reference"><a id="citeref-Sims1994" href="#footnote-Sims1994" class="footnote-ref">[Sims1994]</a><span class="footnote-preview" id="fn-Sims1994"></span></sup>, p. 76.</p><div class="admonition is-warning" id="Warning-405eae45b91853f6"><header class="admonition-header">Warning<a class="admonition-anchor" href="#Warning-405eae45b91853f6" title="Permalink"></a></header><div class="admonition-body"><p>Forced termination takes place after the number of <strong>active</strong> rules stored in the <code>RewritingSystem</code> reaches <code>max_rules</code>.</p></div></div></div><a class="docs-sourcelink" target="_blank" href="https://github.com/kalmarek/KnuthBendix.jl/blob/ed3c4980c7bf37951e4d233a9786cbdeed23fa75/src/knuthbendix2.jl#L9-L28">source</a></section></details></article><p>You can run it on a <code>rws</code> by calling</p><pre><code class="language-julia hljs">knuthbendix(KnuthBendix.Settings(KnuthBendix.KBStack()), rws)</code></pre><p>By default the algorithm terminates early after <code>500</code> of <strong>active</strong> rewriting rules have been found. To control this behaviour <a href="../KB_implementations/#KnuthBendix.Settings"><code>Settings</code></a> struct has many knobs and whistles.</p><div class="admonition is-success" id="Performance-48eeda66884b96e7"><header class="admonition-header">Performance<a class="admonition-anchor" href="#Performance-48eeda66884b96e7" title="Permalink"></a></header><div class="admonition-body"><p>While <code>KBStack</code> vastly outperforms the <a href="../knuthbendix1/#Naive">naive <code>KBPlain</code></a> it is still rather slow. E.g. the eight quotient of (2,3,7) triangle group</p><p class="math-container">\[\langle a,b \mid a^2 = b^3 = (ab)^7 = \left(a^{-1}b^{-1}ab\right)^8 \rangle.\]</p><p>which has a confluent rewriting system with <code>1023</code> rules is still too large to be completed succesfully.</p><p>There are two main performance problems here:</p><ol><li>the poor performance of <a href="../rewriting/#Naive-rewriting">naive rewriting</a> that is still used by <code>KBStack</code>: the complexity of this rewriting depends on the overall size of the rewriting system.</li><li>the fact that <code>find_critical_pairs!</code> and <code>deriverules!</code> <strong>assume and maintain the reducedness</strong> of the rewriting system makes their complexity quadratic with the size of the rewriting system and therefore become the bottleneck for larger rewriting systems.</li></ol><p>To address both problems we will use the theory of Automata and regular languages in <a href="../knuthbendix_idxA/#KnuthBendix.KBIndex"><code>KBIndex</code></a>.</p></div></div><hr/><p>Below is a julia-flavoured pseudocode describing the completion procedure.</p><pre><code class="language-julia hljs">function knuthbendix2(rws::RewritingSystem{W}, ...) where W
    stack = Vector{Tuple{W,W}}()
    rws = reduce(rws) # this is assumed by forceconfluence!

    # ... initialize some temporary structures here
    for ri in rules(rws)
        for rj in rules(rws)
            isactive(ri) || break
            forceconfluence!(rws, stack, ri, rj, ...)

            ri === rj &amp;&amp; break
            isactive(ri) || break
            isactive(rj) || continue
            forceconfluence!(rws, stack, rj, ri, ...)
        end
    end
    remove_inactive!(rws) # all active rules form a reduced confluent rws
    return rws
end</code></pre><p>Not much has changed compared to <code>KBPlain</code> on the surface, but there are more substantial changes under the hood. In particular <a href="#KnuthBendix.forceconfluence!-Tuple{RewritingSystem, Any, Any, Any, KnuthBendix.Workspace}"><code>forceconfluence!</code></a> has become simply</p><pre><code class="language-julia hljs">function forceconfluence!(rws::RewritingSystem, stack, ri, rj, ...)
    find_critical_pairs!(stack, rws, ri, rj, ...)
    deriverules!(rws, stack, ...)
    return rws
end</code></pre><p>I.e. we first push all failures to local confluence derived from <code>ri</code> and <code>rj</code> onto <code>stack</code> (<a href="#KnuthBendix.find_critical_pairs!-Tuple{Any, Any, KnuthBendix.Rule, KnuthBendix.Rule, KnuthBendix.Workspace}"><code>find_critical_pairs!</code></a>), then empty the stack (<a href="../knuthbendix1/#KnuthBendix.deriverule!-Tuple{RewritingSystem, KnuthBendix.Words.AbstractWord, KnuthBendix.Words.AbstractWord}"><code>deriverule!</code></a>). To do this the top pair <code>lhs → rhs</code> is picked from the stack, we mark all the rules in <code>rws</code> that could be reduced with <code>lhs</code> as inactive and push them onto the stack. Only afterwards we push <code>lhs → rhs</code> to <code>rws</code> and we repeat until the stack is empty. More concretely, in julia-flavoured pseudocode,</p><pre><code class="language-julia hljs">while !isempty(stack)
    (a, b) = pop!(stack)
    A, B = rewrite(a, rws), rewrite(b, rws)
    if A ≠ B
        new_rule = Rule(A,B, ordering(rws))
        for rule in rules(rws)
            if isreducible(rule, new_rule)
                deactivate!(rule)
                push!(stack, rule)
            end
        end
        push!(rws, new_rule)
    end
end</code></pre><p>Note that in <code>KBStack</code> we can <code>break</code> (or <code>continue</code>) in the internal loop on the inactivity of rules as specified in the listing above. As in the process of completion the rule <code>ri</code> being currently processed could have been marked as inactive (e.g. it became redundant) it is advisable that those checks are performed after every call to <code>forceconfluence!</code>.</p><h2 id="Internal-functions"><a class="docs-heading-anchor" href="#Internal-functions">Internal functions</a><a id="Internal-functions-1"></a><a class="docs-heading-anchor-permalink" href="#Internal-functions" title="Permalink"></a></h2><article><details class="docstring" open="true"><summary id="KnuthBendix.forceconfluence!-Tuple{RewritingSystem, Any, Any, Any, KnuthBendix.Workspace}"><a class="docstring-binding" href="#KnuthBendix.forceconfluence!-Tuple{RewritingSystem, Any, Any, Any, KnuthBendix.Workspace}"><code>KnuthBendix.forceconfluence!</code></a> — <span class="docstring-category">Method</span></summary><section><div><pre><code class="language-julia hljs">forceconfluence!(rws::RewritingSystem, stack, r₁, r₂[, work = Workspace(rws)])</code></pre><p>Examine overlaps of left hand sides of rules <code>r₁</code> and <code>r₂</code> to find (potential) failures to local confluence. New rules are added to assure local confluence if necessary.</p><p>This version assumes the reducedness of <code>rws</code> so that failures to local confluence are of the form <code>a·b·c</code> with all <code>a</code>, <code>b</code>, <code>c</code> non trivial and <code>lhs₁ = a·b</code> and <code>lhs₂ = b·c</code>.</p><p>This version uses <code>stack</code> to maintain the reducedness of <code>rws</code> and <code>work::Workspace</code> to save allocations in the rewriting.</p><p>See procedure <code>OVERLAP_2</code> in [Sims, p. 77].</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/kalmarek/KnuthBendix.jl/blob/ed3c4980c7bf37951e4d233a9786cbdeed23fa75/src/knuthbendix2.jl#L149-L163">source</a></section></details></article><article><details class="docstring" open="true"><summary id="KnuthBendix.find_critical_pairs!-Tuple{Any, Any, KnuthBendix.Rule, KnuthBendix.Rule, KnuthBendix.Workspace}"><a class="docstring-binding" href="#KnuthBendix.find_critical_pairs!-Tuple{Any, Any, KnuthBendix.Rule, KnuthBendix.Rule, KnuthBendix.Workspace}"><code>KnuthBendix.find_critical_pairs!</code></a> — <span class="docstring-category">Method</span></summary><section><div><pre><code class="language-julia hljs">find_critical_pairs!(stack, rws, r₁::Rule, r₂::Rule[, work=Workspace(rws))</code></pre><p>Find critical pairs derived from suffix-prefix overlaps of lhses of <code>r₁</code> and <code>r₂</code>.</p><p>Such failures (i.e. failures to local confluence) arise as <code>W = ABC</code> where <code>AB</code>, <code>BC</code> are the left-hand-sides of rules <code>r₁</code> and <code>r₂</code>, respectively. It is assumed that all <code>A</code>, <code>B</code> and <code>C</code> are nonempty.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/kalmarek/KnuthBendix.jl/blob/ed3c4980c7bf37951e4d233a9786cbdeed23fa75/src/knuthbendix2.jl#L56-L63">source</a></section></details></article><article><details class="docstring" open="true"><summary id="KnuthBendix.deriverule!-Tuple{RewritingSystem, Any, KnuthBendix.Workspace}"><a class="docstring-binding" href="#KnuthBendix.deriverule!-Tuple{RewritingSystem, Any, KnuthBendix.Workspace}"><code>KnuthBendix.deriverule!</code></a> — <span class="docstring-category">Method</span></summary><section><div><pre><code class="language-julia hljs">deriverule!(rws::RewritingSystem, stack[, work = Workspace(rws)])</code></pre><p>Empty <code>stack</code> of (potentially) critical pairs by deriving and adding new rules to <code>rws</code> resolving the pairs, i.e. maintains local confluence of <code>rws</code>.</p><p>This function may deactivate rules in <code>rws</code> if they are deemed redundant (e.g. follow from the added new rules). See [Sims, p. 76].</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/kalmarek/KnuthBendix.jl/blob/ed3c4980c7bf37951e4d233a9786cbdeed23fa75/src/knuthbendix2.jl#L100-L107">source</a></section></details></article><article><details class="docstring" open="true"><summary id="KnuthBendix.reduce!-Tuple{KnuthBendix.KBStack, RewritingSystem, KnuthBendix.Workspace}"><a class="docstring-binding" href="#KnuthBendix.reduce!-Tuple{KnuthBendix.KBStack, RewritingSystem, KnuthBendix.Workspace}"><code>KnuthBendix.reduce!</code></a> — <span class="docstring-category">Method</span></summary><section><div><pre><code class="language-julia hljs">reduce!(::KBS2Alg, rws::RewritingSystem[, work=Workspace(rws); sort_rules=true])</code></pre><p>Bring <code>rws</code> to its reduced form using the stack-based algorithm.</p><p>For details see <a href="../knuthbendix1/#KnuthBendix.reduce!-Tuple{KnuthBendix.KBPlain, RewritingSystem}"><code>reduce!</code></a>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/kalmarek/KnuthBendix.jl/blob/ed3c4980c7bf37951e4d233a9786cbdeed23fa75/src/knuthbendix2.jl#L206-L212">source</a></section><section><div><pre><code class="language-julia hljs">reduce!(::KBS2Alg, rws::RewritingSystem, stack, ...)</code></pre><p>Append rules from <code>stack</code> to <code>rws</code>, maintaining reducedness.</p><p>Assuming that <code>rws</code> is reduced, merge <code>stack</code> of rules into <code>rws</code> using <a href="#KnuthBendix.deriverule!-Tuple{RewritingSystem, Any, KnuthBendix.Workspace}"><code>deriverule!</code></a>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/kalmarek/KnuthBendix.jl/blob/ed3c4980c7bf37951e4d233a9786cbdeed23fa75/src/knuthbendix2.jl#L245-L251">source</a></section></details></article><section class="footnotes is-size-7"><ul><li class="footnote" id="footnote-Sims1994"><a class="tag is-link" href="#citeref-Sims1994">Sims1994</a>Charles C. Sims <em>Computation with finitely presented groups</em>,          Cambridge University Press, 1994.</li></ul></section></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../knuthbendix1/">« Naive</a><a class="docs-footer-nextpage" href="../knuthbendix_idxA/">Using index automaton »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.16.1 on <span class="colophon-date" title="Sunday 7 December 2025 21:01">Sunday 7 December 2025</span>. Using Julia version 1.6.7.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
